<!DOCTYPE html>
<html>

<head>
    <!----------------------------------------------------------------------------------------------------------->
    <!-- Welcome to Wanderdog! -->
    <!----------------------------------------------------------------------------------------------------------->
    <title>Wanderdog</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.3.1/dist/css/uikit.min.css" />

    <!-- UIkit JS -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.3.1/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.3.1/dist/js/uikit-icons.min.js"></script>

    <!-- Favicon of a dog -->
    <link rel="shortcut icon" type="image/png" href="assets/images/favicon.ico" />
    <!----------------------------------------------------------------------------------------------------------->
    <!-- Google Font: Raleway -->
    <!----------------------------------------------------------------------------------------------------------->
    <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">
    <!-- In-house CSS -->
    <link rel="stylesheet" href="assets/homepageStyle.css">
    <script>
        // Note: This example requires that you consent to location sharing when
        // prompted by your browser. If you see the error "The Geolocation service
        // failed.", it means you probably did not give permission for the browser to
        // locate you.
        var map, infoWindow;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: -34.397, lng: 150.644 },
                zoom: 8
            });
            infoWindow = new google.maps.InfoWindow;

            // Try HTML5 geolocation.
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    infoWindow.setPosition(pos);
                    infoWindow.setContent('Location found.');
                    infoWindow.open(map);
                    map.setCenter(pos);
                }, function () {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
                var redirectHelp = "https://cors-ut-bootcamp.herokuapp.com/";
                // Add hiking sites based on location
                $.ajax({
                    url: redirectHelpHiking + "www.hikingproject.com/data/get-trails?lat=" + crd.latitude + "&lon=" + crd.longitude + "&key=" + hikingProjectAPIKey,
                    method: "GET"
                }).then(function (response) {
                    //Log the resulting object
                    console.log(response);

                    //==================================================
                    // Add the names and urls for the first 10 trails
                    //==================================================
                    hikingSites1.innerHTML = response.trails[0].name;
                    hikingSites1.href = response.trails[0].url;

                    hikingSites2.innerHTML = response.trails[1].name;
                    hikingSites2.href = response.trails[1].url;

                    hikingSites3.innerHTML = response.trails[2].name;
                    hikingSites3.href = response.trails[2].url;

                    hikingSites4.innerHTML = response.trails[3].name;
                    hikingSites4.href = response.trails[3].url;

                    hikingSites5.innerHTML = response.trails[4].name;
                    hikingSites5.href = response.trails[4].url;

                    hikingSites6.innerHTML = response.trails[5].name;
                    hikingSites6.href = response.trails[5].url;

                    hikingSites7.innerHTML = response.trails[6].name;
                    hikingSites7.href = response.trails[6].url;

                    hikingSites8.innerHTML = response.trails[7].name;
                    hikingSites8.href = response.trails[7].url;

                    hikingSites9.innerHTML = response.trails[8].name;
                    hikingSites9.href = response.trails[8].url;

                    hikingSites10.innerHTML = response.trails[9].name;
                    hikingSites10.href = response.trails[9].url;
                    //======================================================================
                    // Add a description for each of these trails under the name and link
                    //======================================================================
                    hikingDescription1.innerHTML = response.trails[0].summary;
                    hikingDescription2.innerHTML = response.trails[1].summary;
                    hikingDescription3.innerHTML = response.trails[2].summary;
                    hikingDescription4.innerHTML = response.trails[3].summary;
                    hikingDescription5.innerHTML = response.trails[4].summary;
                    hikingDescription6.innerHTML = response.trails[5].summary;
                    hikingDescription7.innerHTML = response.trails[6].summary;
                    hikingDescription8.innerHTML = response.trails[7].summary;
                    hikingDescription9.innerHTML = response.trails[8].summary;
                    hikingDescription10.innerHTML = response.trails[9].summary;
                });

                // Finds campsites/facilities
                var queryURL = redirectHelp + "ridb.recreation.gov/api/v1/facilities?limit=50";

                cSites.innerHTML = "Loading...";
                cSites.href = "";
                //===================================================
                // Sends ajax request for Facilities (based on location?)
                //===================================================
                $.ajax({
                    url: queryURL,
                    headers: {
                        apikey: "5dc5ca61-c304-482b-bc02-1fcb1007f0b2"
                    },
                    method: "GET"
                }).then(function (response) {

                    var recData = response.RECDATA;
                    var facilityPetsAllowed = false;

                    function processNextFacility() {
                        if (recData.length < 1) {
                            if (!facilityPetsAllowed) {
                                cSites.innerHTML = "No dog-friendly campgrounds found.";
                                cSites.href = "";
                            }
                            return; //breaks out of function if i exceeds length of facilities listed
                        }
                        // //===================================================
                        // // Randomly Select One of the Facilities from Array
                        // //===================================================
                        let randomIndex = Math.floor(Math.random() * recData.length);
                        let currentFacility = recData[randomIndex];

                        //=================================================================
                        // Remove selected facility from the list so it isn't chosen again
                        // and we know when to stop.
                        //=================================================================
                        recData.splice(randomIndex, 1);

                        let facID = currentFacility.FacilityID;

                        //==================================================================
                        // Create var to Display Facilty Name In HTML Link Box
                        //==================================================================

                        let facName = currentFacility.FacilityName;

                        //==============================================================
                        // Uses Facility ID # to query for all campsites within Facility
                        //==============================================================
                        $.ajax({
                            url: redirectHelp + "ridb.recreation.gov/api/v1/facilities/" + facID + "/campsites?limit=5&offset=0",
                            headers: {
                                apikey: "5dc5ca61-c304-482b-bc02-1fcb1007f0b2"
                            },
                            method: "GET"
                        }).then(function (response) {

                            //==================================================
                            // If No Campgrounds, omit Facility 
                            //==================================================
                            if (response.RECDATA.length >= 1) {
                                // console.log(response.RECDATA);
                                var campGrounds = response.RECDATA;
                                if (!campGrounds) {
                                    processNextFacility();
                                }


                                //===================================================
                                //  Loop thru results and grab Campground Attributes
                                //===================================================

                                for (var i = 0; i < campGrounds.length; i++) {
                                    console.log(campGrounds[i].ATTRIBUTES);
                                    console.log("CHECK");


                                    //=============================================================================
                                    //  Keep Campgrounds where Pets Allowed is an Attribute AND the value is True
                                    //=============================================================================
                                    if (campGrounds[i].ATTRIBUTES) {
                                        var attributes = campGrounds[i].ATTRIBUTES;
                                        var petsAllowed = false;
                                        for (var j = 0; j < attributes.length; j++) {
                                            if (attributes[j].AttributeName === "Pets Allowed" && attributes[j].AttributeValue === "Yes") {
                                                petsAllowed = true;
                                                facilityPetsAllowed = true;

                                                //===================================================
                                                // If Pets are allowed, put into Ptag ID
                                                //===================================================
                                                cSites.innerHTML = (facName);
                                                var cSiteName = $("#cSites").text();
                                                cSites.href = "https://www.google.com/search?q=" + cSiteName;
                                                break;
                                            }
                                        }
                                        if (petsAllowed) {
                                            break;
                                        }
                                    }
                                }
                                if (facilityPetsAllowed == false) {
                                    processNextFacility();
                                }
                            }
                            //=================================================
                            //Else statement if facility has no campgrounds
                            //=================================================
                            else {
                                processNextFacility();
                            }
                        });
                    }
                    processNextFacility();
                })
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }
        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
            infoWindow.open(map);
        }
    </script>
</head>

<body
    class="login uk-cover-container uk-background-secondary uk-flex uk-flex-center uk-flex-middle uk-height-viewport uk-overflow-hidden uk-light"
    data-uk-height-viewport="" data-gr-c-s-loaded="true" cz-shortcut-listen="true" style="min-height: calc(100vh);">

    <div class="uk-container-expand uk-padding-large">

        <!-- Information about Wanderdog and how it works. -->
        <h1 class="uk-heading-line uk-text-center"><span>Wanderdog</span></h1>
        <div>
            Wanderdog allows you to find public-owned land where you can camp and hike with your dog. We have focused on
            areas that allow dogs off-leash. Please keep in mind:
            <p class="uk-text-center uk-heading-line"><span>Unique Rules regarding <a target="_blank"
                        href="https://wilderness.net/learn-about-wilderness/default.php">
                        Wilderness Areas</a> | Common <a target="_blank"
                        href="https://www.blm.gov/programs/recreation/hiking">
                        Hiking Etiquette & Safety</a> Practices</span></p>

            <p class="uk-text-center">Don't forget LED collars or reflective vests for low-light situations!</p>
            <hr>
        </div>

        <div id="contentBox" class="uk-child-width-expand@s" uk-grid>
            <div class="uk-grid-item-match">
                <!-- Google Maps Card -->
                <div>
                    <h3>Location Map</h3>
                    <div id="map"></div>
                </div>
            </div>
            <!-- Campsites -->
            <div>
                <h3>Campsites</h3>
                <dl class="uk-description-list uk-description-list-divider">
                    <dt><a target="_blank" id="cSites"></a></dt>
                </dl>
            </div>
            <!-- Trails -->
            <div>
                <h3>Trails</h3>
                <dl class="uk-description-list uk-description-list-divider uk-overflow-auto">
                    <a target="_blank" id="hikingSites1">
                        <dt class="hikingLink"></dt>
                    </a>
                    <dd id="hikingDescription1"></dd>

                    <a target="_blank" id="hikingSites2">
                        <dt class="hikingLink"></dt>
                    </a>
                    <dd id="hikingDescription2"></dd>

                    <a target="_blank" id="hikingSites3">
                        <dt class="hikingLink"></dt>
                    </a>
                    <dd id="hikingDescription3"></dd>

                    <a target="_blank" id="hikingSites4">
                        <dt class="hikingLink"></dt>
                    </a>
                    <dd id="hikingDescription4"></dd>

                    <a target="_blank" id="hikingSites5">
                        <dt class="hikingLink"></dt>
                    </a>
                    <dd id="hikingDescription5"></dd>

                    <a target="_blank" id="hikingSites6">
                        <dt class="hikingLink"></dt>
                    </a>
                    <dd id="hikingDescription6"></dd>

                    <a target="_blank" id="hikingSites7">
                        <dt class="hikingLink"></dt>
                    </a>
                    <dd id="hikingDescription7"></dd>

                    <a target="_blank" id="hikingSites8">
                        <dt class="hikingLink"></dt>
                    </a>
                    <dd id="hikingDescription8"></dd>

                    <a target="_blank" id="hikingSites9">
                        <dt class="hikingLink"></dt>
                    </a>
                    <dd id="hikingDescription9"></dd>

                    <a target="_blank" id="hikingSites10">
                        <dt class="hikingLink"></dt>
                    </a>
                    <dd id="hikingDescription10"></dd>

                </dl>
            </div>
        </div>
        <!----------------------------------------------------------------------------------------------------------->
        <!--Footer-->
        <!----------------------------------------------------------------------------------------------------------->
        <footer class="footer">
            <div class="uk-padding-small">
                <p id="footerTxt">
                    Wanderdog V2 by <a href="https://github.com/cml2377" class="names">Crystal Ly</a>. Copyright &copy;
                    2020
                </p>
                <a id="contactUs" href="mailto:crystal.ly@utexas.edu">Questions? Comments? Contact Wanderdog here!</a>
            </div>
        </footer>
        <!-- End of Container -->
    </div>


    <!----------------------------------------------------------------------------------------------------------->
    <!--Scripts-->
    <!----------------------------------------------------------------------------------------------------------->
    <script type="text/javascript" src="scripts/moment.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="scripts/googleMapAPI.js"></script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDjORy8G0xS2QjrlQ7uJZWr1mabDPtAMCA&callback=initMap"></script>
    <script type="text/javascript" src="scripts/recreationAPI.js" defer></script>
    <script type="text/javascript" src="scripts/index.js.js"></script>
    <script type="text/javascript" src="scripts/hikingAPI.js"></script>
</body>

</html>